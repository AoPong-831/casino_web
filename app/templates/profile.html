{% extends "base.html" %}
{% block title %}ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸{% endblock %}

{% block content %}
<!-- ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
<div id="menu-button">â˜°</div>

<!-- ã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
<nav id="side-menu">
    <a href="/profile/{{ current_user.id }}">ãƒã‚¤ãƒšãƒ¼ã‚¸</a>
    <a href="/calendar">é–‹å‚¬æ—¥ç¨‹è¡¨</a>
    <a href="/logout">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
    {% if current_user.id == 1 %}
        <hr>
        <a href="/ticket_all">ãƒã‚±ãƒƒãƒˆä¸€è¦§</a>
        <a href="/import_users">ã‚¤ãƒ³ãƒãƒ¼ãƒˆ Users</a>
        <a href="/import_logs">ã‚¤ãƒ³ãƒãƒ¼ãƒˆ Logs</a>
        <a href="/export_users">ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ Users</a>
        <a href="/export_logs">ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ Logs</a>
    {% endif %}
</nav>

<!-- ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤(èƒŒæ™¯ç”¨) -->
<div id="overlay"></div>


<div class="profile-card">
    <h2>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</h2>
    <p><strong>åå‰ï¼š</strong> {{user.name}}</p>
    <p><strong>ãƒ¦ãƒ¼ã‚¶åï¼š</strong> {{user.username}}</p>
    <p><strong>ãƒãƒƒãƒ—ï¼š</strong> {{user.chip}}</p>
    <p><strong>ãƒã‚¤ãƒ³ãƒˆï¼š</strong> {{user.point}}</p>
</div>

<div class="action-buttons">
    <button onclick="window.location.href='/ticket_create_chip/{{ user.id }}'">ğŸ’° ãƒãƒƒãƒ— å¼•å‡ºãƒ»é å…¥</button>
    <button onclick="window.location.href='/exchange/{{ user.id }}'">ğŸ”„ ãƒã‚¤ãƒ³ãƒˆäº¤æ›</button>
    <button onclick="window.location.href='/ticket_create_point/{{ user.id }}'">ğŸŸ ãƒã‚¤ãƒ³ãƒˆç”³è«‹</button>
    <button class="back-btn" onclick="window.location.href='/ranking'">â¬… æˆ»ã‚‹</button>
</div>

<div class="card">
    <h3>ğŸŸ ç”³è«‹æ¸ˆã¿ãƒã‚±ãƒƒãƒˆ</h3>

    {% if tickets == []  or user.id == 1 %}<!--äº¤é€šè²»ãƒœãƒ¼ãƒŠã‚¹ãªã©JackPotç”³è«‹æ‰±ã„ã®ã‚‚ã®ã‚’ã€JackPotã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã«ã„ã¡ã„ã¡è¡¨ç¤ºã—ãªã„ã‚ˆã†ã«ã—ãŸã€‚-->
        <p>ãƒã‚±ãƒƒãƒˆã¯ã‚ã‚Šã¾ã›ã‚“</p>
    {% else %}
        <table class="styled-table">
            <thead>
                <tr>
                    <th>id</th><th>ã‚¿ã‚¤ãƒ—</th><th>ã‚«ãƒ†ã‚´ãƒª</th><th>å€¤</th><th>å‰Šé™¤</th>
                </tr>
            </thead>
            <tbody>
                {% for ticket in tickets %}
                    <tr>
                        <td>{{ ticket.id }}</td>
                        <td>
                            {% if ticket.type == "withdrawal" %}
                                å¼•å‡º
                            {% elif ticket.type == "deposit" %}
                                é å…¥
                            {% elif ticket.type == "add_user" %}
                                ãƒ¦ãƒ¼ã‚¶ç™»éŒ²
                            {% elif ticket.type == "monthly_bonus" %}
                                æœˆåˆã‚ãƒœãƒ¼ãƒŠã‚¹
                            {% endif %}
                        </td>
                        <td>{{ ticket.category }}</td>
                        <td>{{ ticket.value }}</td>
                        <td>
                            <form action="{{ url_for('delete_ticket', id=ticket.id) }}" method="POST">
                                <button class=""danger-btn type="submit">å‰Šé™¤</button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}
</div>

<div class="card">
    <h3>âš™ è¨­å®š</h3>
    {% if user.pw == "test"%}<!--- pw = test ã®æ™‚è¡¨ç¤º -->
        <p class="warn">PWã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ï¼</p>
    {% endif %}
    {% if current_user.id == 1 %}<!--- rootãƒ¦ãƒ¼ã‚¶ ã®æ™‚è¡¨ç¤º -->
        <button onclick="window.location.href='/change_user_name/{{ user.id }}'">åå‰å¤‰æ›´</a></button>
    {% endif %}
    <button onclick="window.location.href='/change_user_username/{{ user.id }}'">ãƒ¦ãƒ¼ã‚¶åå¤‰æ›´</a></button>
    <button onclick="window.location.href='/change_user_pw/{{ user.id }}'">PWå¤‰æ›´</a></button>

    {% if user.station == "None" or user.id == 1%}<!--- pw = test ã®æ™‚è¡¨ç¤º -->
        <p class="warn">æœ€å¯„ã‚Šé§…ã‚’è¨­å®šã—ã¦ãã ã•ã„ï¼</p>
        <button onclick="window.location.href='/change_user_station/{{ user.id }}'">æœ€å¯„ã‚Šé§…å¤‰æ›´</a></button>
    {% endif %}
</div>

<div class="card">
  <h3>ğŸ“Š Log</h3>
  <canvas id="myChart" width="600" height="300"></canvas>
    <script>
        //ã‚°ãƒ©ãƒ•æç”»ãƒ©ã‚¤ãƒ–ãƒ©ãƒª Chart.js ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§æ–°ã—ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ ctxã‚’ä½œæˆ(id=myChart,2Dæç”»ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ)
        const ctx = document.getElementById('myChart').getContext('2d');

        const chart = new Chart(ctx, {
        type: 'line',//ã‚°ãƒ©ãƒ•ã®ç¨®é¡ã‚’æŒ‡å®šã€‚ line = æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•
        data: {//ãƒ‡ãƒ¼ã‚¿ã®è¨­å®š
            labels: {{ dates|tojson }},//Xè»¸ã‚’è¨­å®šã€‚app.py ã‹ã‚‰æ¸¡ã•ã‚ŒãŸ datesã‚’ JSONå½¢å¼ã§å±•é–‹ã—ã¦åŸ‹ã‚è¾¼ã‚€
            datasets: [//å®Ÿéš›ã«è¡¨ç¤ºã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ(ç·š)ã‚’å®šç¾©
            {
            label: 'ãƒãƒƒãƒ—ç·æ•°',
            data: {{ chips|tojson }},//Yè»¸ã‚’è¨­å®šã€‚app.py ã‹ã‚‰æ¸¡ã•ã‚ŒãŸ chipsã‚’å—ã‘å–ã£ã¦æç”»ã€‚
            borderColor: 'rgba(255, 99, 132, 1)',//ç·šã®æ ç·šã®è‰²è¨­å®š(é’ç·‘ç³»ã®ä¸é€æ˜ã‚«ãƒ©ãƒ¼)
            backgroundColor: 'rgba(255, 99, 132, 0.2)',//ç·šã®ä¸‹ã®å¡—ã‚Šã¤ã¶ã—ã®è‰²ã€‚åŠé€æ˜ã€‚
            tension: 0,//ç·šã®æ»‘ã‚‰ã‹ã•(0=ç›´ç·šã€1=ã™ã”ãæ›²ç·š)
            yAxisID: 'left-y'//å·¦è»¸ã«å‰²ã‚Šå½“ã¦
            },
            {
            label: 'ãƒã‚¤ãƒ³ãƒˆç·æ•°',
            data: {{ points|tojson }},//Yè»¸ã‚’è¨­å®šã€‚app.py ã‹ã‚‰æ¸¡ã•ã‚ŒãŸ chipsã‚’å—ã‘å–ã£ã¦æç”»ã€‚
            borderColor: 'rgba(75, 192, 192, 1)',//ç·šã®æ ç·šã®è‰²è¨­å®š(é’ç·‘ç³»ã®ä¸é€æ˜ã‚«ãƒ©ãƒ¼)
            backgroundColor: 'rgba(75, 192, 192, 0.2)',//ç·šã®ä¸‹ã®å¡—ã‚Šã¤ã¶ã—ã®è‰²ã€‚åŠé€æ˜ã€‚
            tension: 0,//ç·šã®æ»‘ã‚‰ã‹ã•(0=ç›´ç·šã€1=ã™ã”ãæ›²ç·š)
            yAxisID: 'right-y'//å³è»¸ã«å‰²ã‚Šå½“ã¦
            }
            ]
        },
        options: {//ã‚°ãƒ©ãƒ•ã®è¨­å®š
            responsive: true,//ã‚°ãƒ©ãƒ•ãŒã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ã‚µã‚¤ã‚ºã«è‡ªå‹•ã§ãƒ•ã‚£ãƒƒãƒˆã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚
            scales: {
                'left-y':{
                    position: 'left',//å·¦ã«è¡¨ç¤ºã™ã‚‹
                    beginAtZero: true,//yè»¸ã‚’0ã‚¹ã‚¿ãƒ¼ãƒˆã«ã—ã¦ã„ã‚‹ã€‚
                    title: {
                        display: true,
                        text: 'ãƒãƒƒãƒ—'
                    }
                },
                'right-y':{
                    position: 'right',
                    beginAtZero: true,
                    grid: {
                        drawOnChartArea: false//é‡ãªã‚Šã‚’é¿ã‘ã‚‹(ã‚°ãƒ©ãƒ•å…¨ä½“ã«ã‚°ãƒªãƒƒãƒ‰ç·šã‚’æ›¸ã‹ãªã„)
                    },
                    title: {
                        display: true,
                        text: 'ãƒã‚¤ãƒ³ãƒˆ'
                    }
                }

            }
        }
        });
    </script>
</div>

{% endblock %}